<!doctype html>
<html>
  <head>
    <title>Viaje Estelar</title>
    <meta http-equiv="Content-Type"
              content="text/html; charset=UTF-8">
  
  </head>
  <body>
	  
	  
<div id="stats"></div>
	  
	  
	  
	  
  <script   src="three.min.js">
  </script>

  <script   src="ATARI_V.js">
  </script>
	  
  <script   src="ATARI_R.js">
  </script>

  <script   src="ATARI_B.js">
  </script>

  <script   src="ATARI_A.js">
  </script>
	  
  <script   src="ATARI_M.js">
  </script>
	  
  <script   src="FANTASMA.js">
  </script>
	  
  <script   src="TIE.js">
  </script>



  <script>




function push(e){

	
	if (e.keyCode===65){
		if(A_V_malla.position.x>-78){
			A_V_malla.translateX( -1 );
		}
		else{
			A_V_malla.translateX( 0 );
		}		
	}
	
	
	if (e.keyCode===90){
		if(A_V_malla.position.x<70){
			A_V_malla.translateX( 1 );
		}
		else{
			A_V_malla.translateX( 0 );
		}		
	}

	if (e.keyCode===83){
		if(A_V_malla.position.y>-35){
			A_V_malla.translateY( -1 );
		}
		else{
			A_V_malla.translateY( 0 );
		}		
	}

	
	if (e.keyCode===68){
		if(A_V_malla.position.y<31){
			A_V_malla.translateY(1 );
		}
		else{
			A_V_malla.translateY( 0 );
		}		
	}
	
	

}


var listener = function() {
	camara.aspect = window.innerWidth/window.innerHeight;
	camara.updateProjectionMatrix();
	renderer.setSize(window.innerWidth, window.innerHeight);
	}



function setup(){
	
	k = 0;
	bandera = 0;
	
	escena = new THREE.Scene();
	camara = new THREE.PerspectiveCamera();
	camara.position.z = 90;

	renderer = new THREE.WebGLRenderer();
	renderer.setSize( window.innerHeight*.95, 
                      window.innerHeight*.95 );
	document.body.appendChild(renderer.domElement);
	
	
raycaster1 = new THREE.Raycaster(TIE.position, new THREE.Vector3(0,0,-1));
raycaster2 = new THREE.Raycaster(TIE.position, new THREE.Vector3(1,0,0));
raycaster3 = new THREE.Raycaster(TIE.position, new THREE.Vector3(-1,0,0));
raycaster4 = new THREE.Raycaster(TIE.position, new THREE.Vector3(0,1,0));
raycaster5 = new THREE.Raycaster(TIE.position, new THREE.Vector3(0,-1,0));
	
	
	
	
for(j=0 ; j <15; j++){		
	for(i=0; i<j/2;i++){ 
		
		malla = new THREE.Mesh(new THREE.SphereGeometry(4,20,20), new THREE.MeshNormalMaterial());
		malla.translateX( 50*(2*Math.random()-1) );
		malla.translateY( 0);
		malla.translateZ( (-800*Math.random())-800*j);
		
			
		Obstaculos.push(malla); 	
		escena.add(malla);
	}
}
	
	
	
	/*

for(j; j <10; j++){

	for(i = 0; i < (j-5)/10; i++){

		
		
		malla = new THREE.Mesh( A_V_forma,A_V_material);
		malla.translateX( 50*(2*Math.random()-1) );
		malla.translateY( 50*(2*Math.random()-1) );
		malla.translateZ( (-300*Math.random())-300*j);
		
		n++;		
		puntos.push(malla);
		escena.add(malla);	
		
		malla = new THREE.Mesh( A_R_forma,A_R_material);
		malla.translateX( 50*(2*Math.random()-1) );
		malla.translateY( 50*(2*Math.random()-1) );
		malla.translateZ( (-300*Math.random())-300*j);
				
		n++;		
		puntos.push(malla);
		escena.add(malla);
		
		malla = new THREE.Mesh( A_B_forma,A_B_material);
		malla.translateX( 50*(2*Math.random()-1) );
		malla.translateY( 50*(2*Math.random()-1) );
		malla.translateZ( (-300*Math.random())-300*j);
		
		
		n++;		
		puntos.push(malla);
		escena.add(malla);
		
		malla = new THREE.Mesh( A_A_forma,A_A_material);
		malla.translateX( 50*(2*Math.random()-1) );
		malla.translateY( 50*(2*Math.random()-1) );
		malla.translateZ( (-300*Math.random())-300*j);
		
		n++;		
		puntos.push(malla);
		escena.add(malla);
		
		
		malla = new THREE.Mesh( A_M_forma,A_M_material);
		malla.translateX( 50*(2*Math.random()-1) );
		malla.translateY( 50*(2*Math.random()-1) );
		malla.translateZ( (-300*Math.random())-300*j);
		
		n++;		
		puntos.push(malla);
		escena.add(malla);
		
	}

}	



for(j; j <15; j++){

	for(i = 0; i < (j-10)/10; i++){		
		
		malla =new THREE.Mesh( P4forma, Fanmaterial );	
		malla.translateX( 50*(2*Math.random()-1) );
		malla.translateY( 50*(2*Math.random()-1) );
		malla.translateZ( (-300*Math.random())-300*j);
		
		n++;		
		puntos.push(malla);
		escena.add(malla);
			
		
	
	}

}	
	
	
	
	
	
	
	*/
	
	
	
	
	
	
	escena.add(TIE);

	var tipoEvento = 'resize';
	var capturar = false;

	window.addEventListener( tipoEvento, listener, capturar);
	window.addEventListener( 'keydown',push, false);

	}



function loop(){
	
	
if(	 TIE.position.z > Obstaculos[k].position.z){





	obstaculo1 = raycaster1.intersectObject(Obstaculos[k]);
	obstaculo2 = raycaster2.intersectObject(Obstaculos[k]);
	obstaculo3 = raycaster3.intersectObject(Obstaculos[k]);
	obstaculo4 = raycaster4.intersectObject(Obstaculos[k]);
	obstaculo5 = raycaster5.intersectObject(Obstaculos[k]);




	if ( (obstaculo1.length>0 && (obstaculo1[0].distance<=6))	||	(obstaculo2.length>0 && (obstaculo2[0].distance<=6))	||	(obstaculo3.length>0 && (obstaculo3[0].distance<=6))	||	(obstaculo4.length>0 && (obstaculo4[0].distance<=4))	||	(obstaculo5.length>0 && (obstaculo5[0].distance<=4))	 ){
			
	camara.position.z-=0;
	TIE.translateZ(0);
	bandera = 1;

	}

	else{
			
	camara.position.z-=2;
	TIE.translateZ(  -2 );
	}

	raycaster1.set(TIE.position, new THREE.Vector3(0,0,-1));
	raycaster2.set(TIE.position, new THREE.Vector3(1,0,0));
	raycaster3.set(TIE.position, new THREE.Vector3(-1,0,0));
	raycaster4.set(TIE.position, new THREE.Vector3(0,1,0));
	raycaster5.set(TIE.position, new THREE.Vector3(0,-1,0));

	
}

else{
	k++;
}
	

	renderer.render( escena, camara ); 
	requestAnimationFrame( loop );
	}




var camara, renderer, escena, malla, material,mov;
var k, bandera;
var Obstaculos = [];
var raycaster1, raycaster2, raycaster3, raycaster4, raycaster5;
var obstaculo1, obstaculo2, obstaculo3, obstaculo4, obstaculo5;
setup();
loop();






    </script>
  </body>
</html>
